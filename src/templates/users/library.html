{% extends 'base.html' %}

{% load crispy_forms_tags %}

{% block content %}


<h1 class="text-center logo my-4">
  Your Library
</h1>
{% if books|length == 0 %}
<div class="container">

     <div class="row justify-content-center">
      <div class="col-lg-8 col-md-10 col-sm-12">
        <div class="card">
          <div class="card-body">
            <form method="POST">
                <p class="lead">Your library is empty :(</p>
                <p class="lead">You can find some books by clicking on "Find books" button in menu or by clicking button
                right there!</p>
                <hr class="my-4">

            <a class="btn btn-primary" href="{% url 'find_book' %}" role="button">Find books</a> <a href='../'>Cancel</a>
            </form>
          </div>
        </div>
      </div>
    </div>
</div>
{% else %}
{% for book in books %}
    <div class="card mb-2" style="margin-left:10%; margin-right:10%;" id="div{{ book.id }}">
        <div class="card-body p-3">
            <div class="row">
                <div class="col-2">
                <img src="{{ book.image }}" class="center">
                </div>

                     <div class="col-10">
                        <div class="row mb-3">
                          <div class="col-6">
                            <p><strong class="text-muted">{{ book.title }}</strong></p>
                            <small class="text-muted">{{ book.author }}</small>
                              <br>
                          </div>
                            <div class="col-6" style="text-align:right;">
                            <small class="text-muted">ID: {{ book.id }}</small>
                            </div>
                        </div>

                        {% if book.description == None %}
                        There is no description :(
                        {% else %}
                        {{ book.description }}
                        {% endif %}
                        <p>
                        <br>

                    <div type="text/css" class = "container"></div>
                    <a class="addbutton btn btn-danger btn-lg" id="like{{ book.id }}" href="#" data-catid="{{ book.id }}">Delete</a>
                    <a class="addbutton btn btn-secondary btn-lg" id="info{{ book.id }}" href="{% url 'book_options' %}">Update</a>
                    </p><p id="message{{book.id}}"></p>
                    </div>

                 </div>
            </div>
        </div>
    </div>

{% endfor %}
{% endif %}

        <script type="text/javascript">
            $('.addbutton').click(function(){
            var id;
            id = $(this).attr("data-catid");
            console.log(id);
            $.ajax(
            {
                type:"GET",
                url: "delete_book",
                data:{
                         book_id: id
            },
            success: function( data )
            {
                if($( '#like'+ id ).text() == 'Delete'){
                    $( '#like'+ id ).removeClass('btn btn-danger btn-lg');
                    $( '#like'+ id ).text('Add');
                    $( '#like'+ id ).addClass('btn btn-primary btn-lg');
                    $( '#div'+ id ).hide();
                }
             }
             })
             });
        </script>

{% endblock %}